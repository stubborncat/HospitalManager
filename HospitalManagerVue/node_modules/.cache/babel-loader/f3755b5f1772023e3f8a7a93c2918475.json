{"remainingRequest":"C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\src\\views\\BuyList.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\src\\views\\BuyList.vue","mtime":1711703202000},{"path":"C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\babel.config.js","mtime":1673698822000},{"path":"C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1711438174000},{"path":"C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1711438178000},{"path":"C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1711438174000},{"path":"C:\\Users\\ADMIN\\Desktop\\毕设 (2)\\HospitalManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1711438180000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGp3dERlY29kZSBmcm9tICJqd3QtZGVjb2RlIjsKaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICJAL3V0aWxzL3N0b3JhZ2UuanMiOwppbXBvcnQgcmVxdWVzdCBmcm9tICJAL3V0aWxzL3JlcXVlc3QuanMiOwppbXBvcnQgeyB0b0xvYWQgfSBmcm9tICJAL3V0aWxzL2luaXRpYWxpemUuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImJ1eUxpc3QiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBkYklkOiAxLAogICAgICBwSWQ6IDEsCiAgICAgIHBOYW1lOiAiYWEiLAogICAgICBkcnVnRGF0YTogW10sCiAgICAgIHNpemU6IDQsCiAgICAgIHBhZ2VOdW1iZXI6IDEsCiAgICAgIHRvdGFsOiAzLAogICAgICBxdWVyeURydWc6ICIiLAogICAgICBkcnVnQnV5RGF0YTogW10sCiAgICAgIGRiVG90YWxQcmljZTogMCwKICAgICAgaWRUaW1lOiAiIiwKICAgICAgYnV5Rm9ybTogewogICAgICAgIGJ1eURhdGU6ICIiCiAgICAgIH0sCiAgICAgIGJ1eURhdGU6ICIiCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgLy/moLnmja5pZOWHj+WwkeiNr+eJqeaVsOmHjwogICAgcmVkdWNlRHJ1Z051bWJlcihkcklkLCB1c2VkTnVtYmVyKSB7CiAgICAgIHJlcXVlc3QuZ2V0KCJkcnVnL3JlZHVjZURydWdOdW1iZXIiLCB7CiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBkcklkOiBkcklkLAogICAgICAgICAgdXNlZE51bWJlcjogdXNlZE51bWJlcgogICAgICAgIH0KICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6I2v54mp5pWw6YeP5LiN6Laz77yB77yBIik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAvL+eCueWHu+aPkOS6pOaMiemSrgogICAgc3VibWl0Q2xpY2soKSB7CiAgICAgIGxldCBkYXRhMiA9IHsKICAgICAgICBidXk6IHsKICAgICAgICAgIHBJZDogdGhpcy5kcnVnQnV5RGF0YS5wSWQKICAgICAgICB9CiAgICAgIH07CiAgICAgIC8vIGNvbnN0IGFkZEJ1eVRlc3QgPSAgYXN5bmMoKSA9PiB7CiAgICAgIC8vICAgYXdhaXQKICAgICAgcmVxdWVzdC5wb3N0KCJwYXRpZW50L2FkZEJ1eSIsIGRhdGEyKS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLor7fmsYLkv6Hmga/plJnor68iKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5kYklkID0gcmVzLmRhdGEuZGF0YTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZHJ1Z0J1eURhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMucmVkdWNlRHJ1Z051bWJlcih0aGlzLmRydWdCdXlEYXRhW2ldLmRySWQsIHRoaXMuZHJ1Z0J1eURhdGFbaV0uZHJOdW0pOwogICAgICAgIH0KICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgIGRiSWQ6IHRoaXMuZGF0YVBhY2thZ2UoKS5kYklkLAogICAgICAgICAgcElkOiB0aGlzLnBJZCwKICAgICAgICAgIHBOYW1lOiB0aGlzLnBOYW1lLAogICAgICAgICAgZGJEcnVnOiB0aGlzLmRhdGFQYWNrYWdlKCkuZGJEcnVnLAogICAgICAgICAgZGJUb3RhbFByaWNlOiB0aGlzLmRhdGFQYWNrYWdlKCkuZGJUb3RhbFByaWNlCiAgICAgICAgfTsKCiAgICAgICAgLy8gY29uc29sZS5sb2coZGF0YSkKICAgICAgICAvLyByZXR1cm4KICAgICAgICByZXF1ZXN0LnBvc3QoImJ1eS91cGRhdGVQdXJjaCIsIGRhdGEpLnRoZW4ocmVzID0+IHsKICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLor7fmsYLkv6Hmga/plJnor68iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLmj5DkuqTmiJDlip/vvIHor7fpgJrnn6XmgqPogIXnmbvlvZXns7vnu5/oh6rliqnnvLTotLnvvIEiKTsKICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCIvcGF0aWVudExheW91dCIpOwogICAgICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpOwogICAgICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIC8v5bCB6KOF5pWw5o2uCiAgICBkYXRhUGFja2FnZSgpIHsKICAgICAgbGV0IGRiRHJ1ZyA9ICIiOwogICAgICBsZXQgZGJUb3RhbFByaWNlID0gdGhpcy5kYlRvdGFsUHJpY2U7CiAgICAgIGxldCBkYklkID0gdGhpcy5kYklkOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZHJ1Z0J1eURhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBkYkRydWcgKz0gdGhpcy5kcnVnQnV5RGF0YVtpXS5kck5hbWUgKyAiKiIgKyB0aGlzLmRydWdCdXlEYXRhW2ldLmRyUHJpY2UgKyAiKOWFgykqIiArIHRoaXMuZHJ1Z0J1eURhdGFbaV0uZHJOdW0gKyAiICI7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBkYklkLAogICAgICAgIGRiRHJ1ZywKICAgICAgICBkYlRvdGFsUHJpY2UKICAgICAgfTsKICAgIH0sCiAgICAvL+iNr+eJqemhtemdouWkp+Wwj+WIh+aNouaXtuinpuWPkQogICAgY2hlY2tTaXplQ2hhbmdlKHNpemUpIHsKICAgICAgdGhpcy5jaGVja1NpemUgPSBzaXplOwogICAgICB0aGlzLnJlcXVlc3RDaGVjaygpOwogICAgfSwKICAgIC8qKg0KICAgICAqIOatpOWkhOmAu+i+kei+g+Wkjeadgu+8jOWuueaYk+WHuueOsOmUmeivrw0KICAgICAqLwogICAgLy/oja/nianliJfooajngrnlh7vnp7vpmaTmjInpkq4KICAgIGRlbGV0ZURydWcoZHJJZCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZHJ1Z0J1eURhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5kcnVnQnV5RGF0YVtpXS5kcklkID09PSBkcklkKSB7CiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZHJ1Z0RhdGEubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgaWYgKHRoaXMuZHJ1Z0RhdGFbal0uZHJJZCA9PT0gZHJJZCkgdGhpcy5kcnVnRGF0YVtqXS5kck51bWJlciArPSAxOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5kcnVnQnV5RGF0YVtpXS5kck51bSAtPSAxOwogICAgICAgICAgdGhpcy5kcnVnQnV5RGF0YVtpXS5kclN1bSA9IHRoaXMuZHJ1Z0J1eURhdGFbaV0uZHJQcmljZSAqIHRoaXMuZHJ1Z0J1eURhdGFbaV0uZHJOdW07CiAgICAgICAgICB0aGlzLmRiVG90YWxQcmljZSAtPSB0aGlzLmRydWdCdXlEYXRhW2ldLmRyUHJpY2U7IC8v6I2v54mp5Lu35qC85oC76K6hCiAgICAgICAgICBpZiAodGhpcy5kcnVnQnV5RGF0YVtpXS5kck51bSA9PT0gMCkgdGhpcy5kcnVnQnV5RGF0YS5zcGxpY2UoaSwgMSk7IC8v77yB77yB77yB77yB77yB77yB5Yig6Zmk5pWw57uE5Lit5LiL5qCH5Li6aeeahOWFg+e0oAogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8v6I2v54mp5YiX6KGo54K55Ye75aKe5Yqg5oyJ6ZKuCiAgICBhZGREcnVnKGRySWQpIHsKICAgICAgcmVxdWVzdC5nZXQoImRydWcvZmluZERydWciLCB7CiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBkcklkOiBkcklkCiAgICAgICAgfQogICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1cyAhPSAyMDApIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCLkv6Hmga/or7fmsYLlpLHotKUiKTsKICAgICAgICAvL+WQjuerr+S8oOi/h+adpeeahOaYr+Wvueixoe+8jOihqOagvOe7keWumueahOaVsOe7hAogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kcnVnQnV5RGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHRoaXMuZHJ1Z0J1eURhdGFbaV0uZHJJZCA9PT0gcmVzLmRhdGEuZGF0YS5kcklkKSB7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5kcnVnRGF0YS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgIGlmICh0aGlzLmRydWdEYXRhW2pdLmRySWQgPT09IHJlcy5kYXRhLmRhdGEuZHJJZCAmJiB0aGlzLmRydWdEYXRhW2pdLmRyTnVtYmVyID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5kcnVnRGF0YVtqXS5kck51bWJlciAtPSAxOwogICAgICAgICAgICAgICAgdGhpcy5kcnVnQnV5RGF0YVtpXS5kck51bSArPSAxOwogICAgICAgICAgICAgICAgdGhpcy5kcnVnQnV5RGF0YVtpXS5kclN1bSA9IHRoaXMuZHJ1Z0J1eURhdGFbaV0uZHJQcmljZSAqIHRoaXMuZHJ1Z0J1eURhdGFbaV0uZHJOdW07CiAgICAgICAgICAgICAgICB0aGlzLmRiVG90YWxQcmljZSArPSB0aGlzLmRydWdCdXlEYXRhW2ldLmRyUHJpY2U7IC8v6I2v54mp5Lu35qC85oC76K6hCiAgICAgICAgICAgICAgICAvL3JldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZHJ1Z0RhdGEubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICh0aGlzLmRydWdEYXRhW2pdLmRySWQgPT09IHJlcy5kYXRhLmRhdGEuZHJJZCAmJiB0aGlzLmRydWdEYXRhW2pdLmRyTnVtYmVyIDw9IDApIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5kcnVnQnV5RGF0YS5wdXNoKHsKICAgICAgICAgIGRySWQ6IHJlcy5kYXRhLmRhdGEuZHJJZCwKICAgICAgICAgIGRyUHJpY2U6IHJlcy5kYXRhLmRhdGEuZHJQcmljZSwKICAgICAgICAgIGRyTmFtZTogcmVzLmRhdGEuZGF0YS5kck5hbWUsCiAgICAgICAgICBkck51bTogMSwKICAgICAgICAgIGRyU3VtOiByZXMuZGF0YS5kYXRhLmRyUHJpY2UKICAgICAgICB9KTsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZHJ1Z0RhdGEubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICh0aGlzLmRydWdEYXRhW2pdLmRySWQgPT09IHJlcy5kYXRhLmRhdGEuZHJJZCkgdGhpcy5kcnVnRGF0YVtqXS5kck51bWJlciAtPSAxOwogICAgICAgIH0KICAgICAgICB0aGlzLmRiVG90YWxQcmljZSArPSByZXMuZGF0YS5kYXRhLmRyUHJpY2U7IC8v6I2v54mp5Lu35qC85oC76K6hCgogICAgICAgIGNvbnNvbGUubG9nKHJlcy5kYXRhLmRhdGEpOwogICAgICB9KTsKICAgIH0sCiAgICAvL+iNr+eJqemhtemdouWkp+Wwj+WIh+aNouaXtuinpuWPkQogICAgaGFuZGxlU2l6ZUNoYW5nZShzaXplKSB7CiAgICAgIHRoaXMuc2l6ZSA9IHNpemU7CiAgICAgIHRoaXMucmVxdWVzdERydWcoKTsKICAgIH0sCiAgICAvL+iNr+eJqemhteaVsOWIh+aNouaXtuinpuWPkQogICAgaGFuZGxlQ3VycmVudENoYW5nZShudW0pIHsKICAgICAgdGhpcy5wYWdlTnVtYmVyID0gbnVtOwogICAgICB0aGlzLnJlcXVlc3REcnVnKCk7CiAgICB9LAogICAgLy/ojrflj5boja/nianliJfooagKICAgIHJlcXVlc3REcnVnKCkgewogICAgICByZXF1ZXN0LmdldCgiZHJ1Zy9maW5kQWxsRHJ1Z3MiLCB7CiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBzaXplOiB0aGlzLnNpemUsCiAgICAgICAgICBwYWdlTnVtYmVyOiB0aGlzLnBhZ2VOdW1iZXIsCiAgICAgICAgICBxdWVyeTogdGhpcy5xdWVyeURydWcKICAgICAgICB9CiAgICAgIH0pLnRoZW4ocmVzID0+IHsKICAgICAgICBpZiAocmVzLmRhdGEuc3RhdHVzICE9IDIwMCkgdGhpcy4kbWVzc2FnZS5lcnJvcigi6I635Y+W5L+h5oGv5aSx6LSlIik7CiAgICAgICAgdGhpcy5kcnVnRGF0YSA9IHJlcy5kYXRhLmRhdGEuZHJ1Z3M7CiAgICAgICAgdGhpcy50b3RhbCA9IHJlcy5kYXRhLmRhdGEudG90YWw7CiAgICAgICAgY29uc29sZS5sb2coIj09PT09PT09PT09PT09IiArIHJlcy5kYXRhLmRhdGEpOwogICAgICB9KTsKICAgIH0sCiAgICAvL+iOt+WPluaCo+iAheS/oeaBrwogICAgcmVxdWVzdFBhdGllbnQoKSB7CiAgICAgIHJlcXVlc3QuZ2V0KCJkb2N0b3IvZmluZFBhdGllbnRCeUlkIiwgewogICAgICAgIHBhcmFtczogewogICAgICAgICAgcElkOiB0aGlzLnBJZAogICAgICAgIH0KICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHJlcyk7CiAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1cyAhPSAyMDApIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuiOt+WPluS/oeaBr+Wksei0pSIpOwogICAgICAgIHRoaXMucE5hbWUgPSByZXMuZGF0YS5kYXRhLnBOYW1lOwogICAgICAgIHRoaXMucEdlbmRlciA9IHJlcy5kYXRhLmRhdGEucEdlbmRlcjsKICAgICAgICB0aGlzLnBQaG9uZSA9IHJlcy5kYXRhLmRhdGEucFBob25lOwogICAgICB9KTsKICAgIH0sCiAgICAvL3Rva2Vu6Kej56CBCiAgICB0b2tlbkRlY29kZSh0b2tlbikgewogICAgICBpZiAodG9rZW4gIT09IG51bGwpIHJldHVybiBqd3REZWNvZGUodG9rZW4pOwogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMucE5hbWUgPSB0aGlzLnRva2VuRGVjb2RlKGdldFRva2VuKCkpLnBOYW1lOwogICAgdGhpcy5wSWQgPSB0aGlzLnRva2VuRGVjb2RlKGdldFRva2VuKCkpLnBJZDsKICAgIHRoaXMuZGJJZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmRiSWQ7CiAgICB0aGlzLnJlcXVlc3RQYXRpZW50KCk7CiAgICB0aGlzLnJlcXVlc3REcnVnKCk7CiAgICB0aGlzLnJlcXVlc3RDaGVjaygpOwogIH0KfTs="},{"version":3,"names":["jwtDecode","getToken","request","toLoad","name","data","dbId","pId","pName","drugData","size","pageNumber","total","queryDrug","drugBuyData","dbTotalPrice","idTime","buyForm","buyDate","methods","reduceDrugNumber","drId","usedNumber","get","params","then","res","status","$message","error","submitClick","data2","buy","post","i","length","drNum","dataPackage","dbDrug","success","$router","push","console","log","catch","err","drName","drPrice","checkSizeChange","checkSize","requestCheck","deleteDrug","j","drNumber","drSum","splice","addDrug","handleSizeChange","requestDrug","handleCurrentChange","num","query","drugs","requestPatient","pGender","pPhone","tokenDecode","token","created","$route"],"sources":["src/views/BuyList.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-card>\r\n      <!-- 药物表格 -->\r\n      <el-row>\r\n        <el-col :span=\"12\">\r\n          <el-input\r\n            v-model=\"queryDrug\"\r\n            placeholder=\"请输入名称查询\"\r\n            class=\"drugInput\"\r\n          >\r\n            <el-button\r\n              slot=\"append\"\r\n              icon=\"el-icon-search\"\r\n              @click=\"requestDrug\"\r\n            ></el-button>\r\n          </el-input>\r\n          <el-table :data=\"drugData\" stripe border>\r\n            <el-table-column label=\"编号\" prop=\"drId\"></el-table-column>\r\n            <el-table-column label=\"名称\" prop=\"drName\"></el-table-column>\r\n            <el-table-column label=\"剩余数量\" prop=\"drNumber\"></el-table-column>\r\n            <el-table-column label=\"单位\" prop=\"drUnit\"></el-table-column>\r\n            <el-table-column label=\"单价\" prop=\"drPrice\"></el-table-column>\r\n            <el-table-column label=\"操作\" width=\"140\" fixed=\"right\">\r\n              <template slot-scope=\"scope\">\r\n                <el-button\r\n                  type=\"success\"\r\n                  style=\"font-size: 14px;\"\r\n                  @click=\"addDrug(scope.row.drId)\"\r\n                >\r\n                  <i class=\"iconfont icon-r-add\" style=\"font-size: 16px;\"></i>\r\n                  增加</el-button\r\n                >\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n          <!-- 分页 -->\r\n          <el-pagination\r\n            @size-change=\"handleSizeChange\"\r\n            @current-change=\"handleCurrentChange\"\r\n            background\r\n            layout=\"total, sizes, prev, pager, next\"\r\n            :total=\"total\"\r\n            :page-size=\"size\"\r\n            :page-sizes=\"[1, 2, 4, 8, 16]\"\r\n          >\r\n          </el-pagination>\r\n          <el-row></el-row>\r\n        </el-col>\r\n        <!-- 右边已选择的药物 -->\r\n        <el-col :span=\"12\" class=\"drugRigth\">\r\n          <el-table stripe border :data=\"drugBuyData\" class=\"rigthTable\">\r\n            <el-table-column label=\"编号\" prop=\"drId\"></el-table-column>\r\n            <el-table-column label=\"名称\" prop=\"drName\"></el-table-column>\r\n            <el-table-column label=\"单价\" prop=\"drPrice\"></el-table-column>\r\n            <el-table-column label=\"数量\" prop=\"drNum\"></el-table-column>\r\n            <el-table-column label=\"小记\" prop=\"drSum\"></el-table-column>\r\n            <el-table-column label=\"操作\" width=\"140\" fixed=\"right\">\r\n              <template slot-scope=\"scope\">\r\n                <el-button\r\n                  type=\"danger\"\r\n\r\n                  style=\"font-size: 14px;\"\r\n                  icon=\"iconfont icon-r-delete\"\r\n                  @click=\"deleteDrug(scope.row.drId)\"\r\n                > 移除</el-button\r\n                >\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n          <el-tag>共计：{{ dbTotalPrice }}元</el-tag>\r\n        </el-col>\r\n      </el-row>\r\n      <el-col :span=\"3\">\r\n        <el-button type=\"success\" @click=\"submitClick\" style=\"font-size: 18px;\"><i class=\"iconfont icon-r-yes\" style=\"font-size: 22px\"></i> 提交</el-button>\r\n      </el-col>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n<script>\r\nimport jwtDecode from \"jwt-decode\";\r\nimport { getToken } from \"@/utils/storage.js\";\r\nimport request from \"@/utils/request.js\";\r\nimport { toLoad } from \"@/utils/initialize.js\";\r\nexport default {\r\n  name: \"buyList\",\r\n  data() {\r\n    return {\r\n      dbId: 1,\r\n      pId: 1,\r\n      pName: \"aa\",\r\n      drugData: [],\r\n      size: 4,\r\n      pageNumber: 1,\r\n      total: 3,\r\n      queryDrug: \"\",\r\n      drugBuyData: [],\r\n      dbTotalPrice: 0,\r\n      idTime: \"\",\r\n      buyForm: { buyDate: \"\" },\r\n      buyDate: \"\",\r\n\r\n\r\n    };\r\n  },\r\n  methods: {\r\n    //根据id减少药物数量\r\n    reduceDrugNumber(drId, usedNumber) {\r\n      request\r\n        .get(\"drug/reduceDrugNumber\", {\r\n          params: {\r\n            drId: drId,\r\n            usedNumber: usedNumber,\r\n          },\r\n        })\r\n        .then((res) => {\r\n          if (res.data.status !== 200) {\r\n            this.$message.error(\"药物数量不足！！\");\r\n          }\r\n        });\r\n    },\r\n    //点击提交按钮\r\n    submitClick() {\r\n      let data2 = {\r\n        buy : {\r\n          pId : this.drugBuyData.pId\r\n        }\r\n      }\r\n      // const addBuyTest =  async() => {\r\n      //   await\r\n      request.post(\"patient/addBuy\",data2)\r\n      .then((res)=>{\r\n        if (res.data.status !== 200) {\r\n          this.$message.error(\"请求信息错误\");\r\n          return;\r\n        }\r\n        this.dbId = res.data.data;\r\n        for (let i = 0; i < this.drugBuyData.length; i++) {\r\n          this.reduceDrugNumber(\r\n            this.drugBuyData[i].drId,\r\n            this.drugBuyData[i].drNum\r\n          );\r\n        }\r\n\r\n        let data = {\r\n          dbId: this.dataPackage().dbId,\r\n          pId: this.pId,\r\n          pName: this.pName,\r\n          dbDrug: this.dataPackage().dbDrug,\r\n          dbTotalPrice: this.dataPackage().dbTotalPrice,\r\n        };\r\n\r\n        // console.log(data)\r\n        // return\r\n        request\r\n          .post(\"buy/updatePurch\", data)\r\n          .then((res) => {\r\n            if (res.data.status !== 200) {\r\n              this.$message.error(\"请求信息错误\");\r\n              return;\r\n            }\r\n            this.$message.success(\"提交成功！请通知患者登录系统自助缴费！\");\r\n            this.$router.push(\"/patientLayout\");\r\n            console.log(res.data);\r\n          })\r\n          .catch((err) => {\r\n            console.error(err);\r\n          });\r\n      })\r\n    },\r\n    //封装数据\r\n    dataPackage() {\r\n      let dbDrug = \"\";\r\n      let dbTotalPrice = this.dbTotalPrice;\r\n      let dbId = this.dbId;\r\n\r\n      for (let i = 0; i < this.drugBuyData.length; i++) {\r\n        dbDrug +=\r\n          this.drugBuyData[i].drName +\r\n          \"*\" +\r\n          this.drugBuyData[i].drPrice +\r\n          \"(元)*\" +\r\n          this.drugBuyData[i].drNum +\r\n          \" \";\r\n      }\r\n      return { dbId, dbDrug, dbTotalPrice };\r\n\r\n    },\r\n    //药物页面大小切换时触发\r\n    checkSizeChange(size) {\r\n      this.checkSize = size;\r\n      this.requestCheck();\r\n    },\r\n\r\n    /**\r\n     * 此处逻辑较复杂，容易出现错误\r\n     */\r\n    //药物列表点击移除按钮\r\n    deleteDrug(drId) {\r\n      for (let i = 0; i < this.drugBuyData.length; i++) {\r\n        if (this.drugBuyData[i].drId === drId) {\r\n          for (let j = 0; j < this.drugData.length; j++) {\r\n            if (this.drugData[j].drId === drId) this.drugData[j].drNumber += 1;\r\n          }\r\n          this.drugBuyData[i].drNum -= 1;\r\n          this.drugBuyData[i].drSum =\r\n            this.drugBuyData[i].drPrice * this.drugBuyData[i].drNum;\r\n          this.dbTotalPrice -= this.drugBuyData[i].drPrice; //药物价格总计\r\n          if (this.drugBuyData[i].drNum === 0) this.drugBuyData.splice(i, 1); //！！！！！！删除数组中下标为i的元素\r\n        }\r\n      }\r\n    },\r\n    //药物列表点击增加按钮\r\n    addDrug(drId) {\r\n      request\r\n        .get(\"drug/findDrug\", {\r\n          params: {\r\n            drId: drId,\r\n          },\r\n        })\r\n        .then((res) => {\r\n          if (res.data.status != 200) return this.$message.error(\"信息请求失败\");\r\n          //后端传过来的是对象，表格绑定的数组\r\n          for (let i = 0; i < this.drugBuyData.length; i++) {\r\n            if (this.drugBuyData[i].drId === res.data.data.drId) {\r\n              for (let j = 0; j < this.drugData.length; j++) {\r\n                if (\r\n                  this.drugData[j].drId === res.data.data.drId &&\r\n                  this.drugData[j].drNumber > 0\r\n                ) {\r\n                  this.drugData[j].drNumber -= 1;\r\n                  this.drugBuyData[i].drNum += 1;\r\n                  this.drugBuyData[i].drSum =\r\n                    this.drugBuyData[i].drPrice * this.drugBuyData[i].drNum;\r\n                  this.dbTotalPrice += this.drugBuyData[i].drPrice; //药物价格总计\r\n                  //return;\r\n                }\r\n              }\r\n              return;\r\n            }\r\n          }\r\n          for (let j = 0; j < this.drugData.length; j++) {\r\n            if (\r\n              this.drugData[j].drId === res.data.data.drId &&\r\n              this.drugData[j].drNumber <= 0\r\n            )\r\n              return;\r\n          }\r\n          this.drugBuyData.push({\r\n            drId: res.data.data.drId,\r\n            drPrice: res.data.data.drPrice,\r\n            drName: res.data.data.drName,\r\n            drNum: 1,\r\n            drSum: res.data.data.drPrice,\r\n          });\r\n          for (let j = 0; j < this.drugData.length; j++) {\r\n            if (this.drugData[j].drId === res.data.data.drId)\r\n              this.drugData[j].drNumber -= 1;\r\n          }\r\n          this.dbTotalPrice += res.data.data.drPrice; //药物价格总计\r\n\r\n          console.log(res.data.data);\r\n        });\r\n    },\r\n    //药物页面大小切换时触发\r\n    handleSizeChange(size) {\r\n      this.size = size;\r\n      this.requestDrug();\r\n    },\r\n    //药物页数切换时触发\r\n    handleCurrentChange(num) {\r\n      this.pageNumber = num;\r\n      this.requestDrug();\r\n    },\r\n\r\n    //获取药物列表\r\n    requestDrug() {\r\n      request\r\n        .get(\"drug/findAllDrugs\", {\r\n          params: {\r\n            size: this.size,\r\n            pageNumber: this.pageNumber,\r\n            query: this.queryDrug,\r\n          },\r\n        })\r\n        .then((res) => {\r\n          if (res.data.status != 200) this.$message.error(\"获取信息失败\");\r\n          this.drugData = res.data.data.drugs;\r\n          this.total = res.data.data.total;\r\n\r\n          console.log(\"==============\"+res.data.data);\r\n        });\r\n    },\r\n    //获取患者信息\r\n    requestPatient() {\r\n      request\r\n        .get(\"doctor/findPatientById\", {\r\n          params: {\r\n            pId: this.pId,\r\n          },\r\n        })\r\n        .then((res) => {\r\n          console.log(res);\r\n          if (res.data.status != 200) this.$message.error(\"获取信息失败\");\r\n          this.pName = res.data.data.pName;\r\n          this.pGender = res.data.data.pGender;\r\n          this.pPhone = res.data.data.pPhone;\r\n        });\r\n    },\r\n    //token解码\r\n    tokenDecode(token) {\r\n      if (token !== null) return jwtDecode(token);\r\n    },\r\n  },\r\n  created() {\r\n    this.pName = this.tokenDecode(getToken()).pName;\r\n    this.pId = this.tokenDecode(getToken()).pId;\r\n    this.dbId = this.$route.query.dbId;\r\n    this.requestPatient();\r\n    this.requestDrug();\r\n    this.requestCheck();\r\n  },\r\n};\r\n</script>\r\n<style lang=\"scss\">\r\n// 让文字居中\r\n.drugRigth {\r\n  text-align: center;\r\n}\r\n.el-tag {\r\n  margin: 8px;\r\n}\r\n.rigthTable {\r\n  margin-top: 56px;\r\n  margin-left: 8px;\r\n}\r\n.drugInput {\r\n  margin-top: 8px;\r\n  margin-bottom: 8px;\r\n}\r\n.el-row {\r\n  margin: 5px;\r\n}\r\n.orderInput {\r\n  width: 240px;\r\n}\r\n.el-pagination {\r\n  margin: 8px;\r\n}\r\n</style>"],"mappings":"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"}]}